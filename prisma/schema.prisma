generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model BotInstance {
  id                 String         @id @default(cuid())
  userWalletAddress  String         @unique
  userSubaccount     String
  capitalUSDC        Float
  volumeTargetUSDC   Float
  bias               String
  strategy           String         @default("twap")
  market             String
  marketName         String
  isRunning          Boolean        @default(true)
  cumulativeVolume   Float          @default(0)
  ordersPlaced       Int            @default(0)
  currentCapitalUsed Float          @default(0)
  lastOrderTime      DateTime?
  lastTwapOrderTime  DateTime?      // Track when we placed a TWAP that's still filling
  error              String?
  sessionId          String?        // Track which run/session orders belong to
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  orders             OrderHistory[]
}

model OrderHistory {
  id              String      @id @default(cuid())
  botId           String
  sessionId       String?     // Which bot session this order belongs to
  timestamp       DateTime    @default(now())
  txHash          String
  direction       String
  strategy        String      @default("twap")
  size            Int
  volumeGenerated Float
  success         Boolean
  entryPrice      Float?
  exitPrice       Float?
  pnl             Float       @default(0)
  positionHeldMs  Int         @default(0)
  bot             BotInstance @relation(fields: [botId], references: [id], onDelete: Cascade)

  @@index([botId])
  @@index([sessionId])
}
